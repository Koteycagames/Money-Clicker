<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Money Clicker $$$</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://pl28381542.effectivegatecpm.com/a7/c6/45/a7c6454f1cdb67023344f46b3d0d4773.js"></script>
</head>
<body>

    <div class="container" style="width: 400px;">
        <div id="user-info" style="font-size: 0.8rem; color: #888;">Загрузка...</div>
        
        <div id="money-display">$0.00</div>
        
        <button id="click-btn">КЛИК</button>
        
        <div class="tabs">
            <h3>Магазин</h3>
            <p>В разработке...</p>
        </div>

        <div class="tabs">
            <h3>Задания</h3>
            <p>В разработке...</p>
        </div>
        
        <div class="ad-container">
            <script async="async" data-cfasync="false" src="https://pl28384763.effectivegatecpm.com/4f46afbe5794b0570feb06a1295424d5/invoke.js"></script>
            <div id="container-4f46afbe5794b0570feb06a1295424d5"></div>
        </div>

        <button id="logoutBtn" class="logout-btn">Выйти</button>
    </div>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        let currentMoney = 0.00;
        let userId = null;
        let isCooldown = false; // Флаг: true, если идет перезарядка

        // Проверка входа
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('user-info').innerText = "ID: " + user.email;
                
                const userRef = ref(db, 'users/' + userId);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        // Если забанен
                        if (data.banned && data.banned !== false) {
                            window.location.href = "ban.html";
                            return;
                        }
                        
                        // Получаем деньги (если мы не кликали сами только что, это синхронизирует счет)
                        currentMoney = parseFloat(data.money) || 0;
                        updateDisplay();
                    }
                });
            } else {
                window.location.href = "index.html";
            }
        });

        const clickBtn = document.getElementById('click-btn');

        // Обработчик клика
        clickBtn.addEventListener('click', () => {
            // Если нет ID или уже идет перезарядка — выходим
            if (!userId || isCooldown) return;

            // 1. Блокируем кнопку
            isCooldown = true;
            
            // 2. Добавляем класс анимации (кнопка станет серой и начнет зеленеть)
            clickBtn.classList.add('cooldown');

            // 3. Начисляем деньги
            currentMoney += 0.01;
            updateDisplay();

            // 4. Сохраняем в БД
            set(ref(db, 'users/' + userId + '/money'), parseFloat(currentMoney.toFixed(2)));

            // 5. Ждем 1 секунду (1000 мс)
            setTimeout(() => {
                isCooldown = false; // Снимаем блокировку
                clickBtn.classList.remove('cooldown'); // Убираем анимацию (кнопка снова полностью зеленая)
            }, 1000);
        });

        function updateDisplay() {
            document.getElementById('money-display').innerText = '$' + currentMoney.toFixed(2);
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });
    </script>
</body>
</html>
