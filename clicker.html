<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Money Clicker $$$</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://pl28381542.effectivegatecpm.com/a7/c6/45/a7c6454f1cdb67023344f46b3d0d4773.js"></script>
</head>
<body>

    <div id="ad-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>üéÅ –ë–æ–Ω—É—Å –Ω–∞–π–¥–µ–Ω!</h3>
            <p>–ù–∞–≥—Ä–∞–¥–∞: <span id="reward-text" class="reward-highlight">???</span></p>
            
            <p style="margin: 10px 0; font-weight: bold; color: #fff;">
                –ù—É–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º: <span id="ads-counter" style="color: #4caf50;">0/0</span>
            </p>

            <p style="font-size: 0.8rem; color: #aaa;">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>
            
            <button id="watch-ad-btn" style="background-color: #4caf50;">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É</button>
            <button id="close-modal-btn" class="secondary-btn" style="background-color: #f44336;">–û—Ç–∫–∞–∑–∞—Ç—å—Å—è</button>
        </div>
    </div>

    <div class="container">
        <div id="user-info" style="font-size: 0.8rem; color: #888;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        
        <div id="money-display">$0.00</div>
        <div id="cpc-display" style="font-size: 0.8rem; color: #aaa; margin-bottom: 10px;">–ó–∞ –∫–ª–∏–∫: $0.01</div>
        
        <button id="click-btn">–ö–õ–ò–ö</button>
        
        <div class="tabs">
            <h3>üç™ –ú–∞–≥–∞–∑–∏–Ω –ü–µ—á–µ–Ω–µ–∫</h3>
            <div id="shop-list" class="shop-container">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞...</p>
            </div>
        </div>

        <div class="tabs">
            <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
            <p>–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...</p>
        </div>
        
        <div class="ad-container">
            <script async="async" data-cfasync="false" src="https://pl28384763.effectivegatecpm.com/4f46afbe5794b0570feb06a1295424d5/invoke.js"></script>
            <div id="container-4f46afbe5794b0570feb06a1295424d5"></div>
        </div>

        <button id="logoutBtn" class="logout-btn">–í—ã–π—Ç–∏</button>
    </div>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        const AD_LINK = "https://www.effectivegatecpm.com/n7h7t8tnc?key=63d760e9d5c26b2ae739b39ba4062a5f"; 

        const SHOP_ITEMS = [
            { id: "wool", name: "–®–µ—Ä—Å—Ç—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1, power: 0.10 },
            { id: "salt", name: "–°–æ–ª–µ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 3, power: 0.30 },
            { id: "coal", name: "–£–≥–æ–ª—å–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 5, power: 0.50 },
            { id: "foil", name: "–ü–µ—á–µ–Ω—å–µ –∏–∑ —Ñ–æ–ª—å–≥–∏", price: 30, power: 1.00 },
            { id: "alum", name: "–ê–ª—é–º–∏–Ω–∏–µ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 150, power: 1.50 },
            { id: "leaf", name: "–õ–∏—Å—Ç–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 400, power: 2.00 },
            { id: "copper", name: "–ú–µ–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 800, power: 3.00 },
            { id: "lead", name: "–°–≤–∏–Ω—Ü–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1000, power: 4.50 },
            { id: "tungsten", name: "–í–æ–ª—å—Ñ—Ä–∞–º–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1300, power: 6.00 },
            { id: "silver", name: "–°–µ—Ä–µ–±—Ä—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1750, power: 8.00 },
            { id: "gold", name: "–ó–æ–ª–æ—Ç–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 2000, power: 10.00 },
            { id: "emerald", name: "–ò–∑—É–º—Ä—É–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 2400, power: 13.00 },
            { id: "diamond", name: "–ê–ª–º–∞–∑–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 3500, power: 20.00 },
            { id: "rainbow", name: "–†–∞–¥—É–∂–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 5000, power: 30.00 }
        ];

        let currentMoney = 0.00;
        let clickPower = 0.01; 
        let userId = null;
        let isCooldown = false;
        let ownedUpgrades = []; 

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º—É–ª—å—Ç–∏-—Ä–µ–∫–ª–∞–º—ã
        let adsRequired = 0;
        let adsWatchedCount = 0;
        let currentReward = null;

        // --- FIREBASE ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('user-info').innerText = "ID: " + user.email;
                
                const userRef = ref(db, 'users/' + userId);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        if (data.banned && data.banned !== false) {
                            window.location.href = "ban.html";
                            return;
                        }
                        
                        currentMoney = parseFloat(data.money) || 0;
                        ownedUpgrades = data.upgrades || ["start"];
                        
                        recalcClickPower();
                        updateDisplay();
                        renderShop();
                    }
                });
                
                startBalloonSpawner();
            } else {
                window.location.href = "index.html";
            }
        });

        function recalcClickPower() {
            let maxPower = 0.01; 
            SHOP_ITEMS.forEach(item => {
                if (ownedUpgrades.includes(item.id)) {
                    if (item.power > maxPower) maxPower = item.power;
                }
            });
            clickPower = maxPower;
        }

        // --- –ö–õ–ò–ö–ò ---
        const clickBtn = document.getElementById('click-btn');
        clickBtn.addEventListener('click', () => {
            if (!userId || isCooldown) return;
            isCooldown = true;
            clickBtn.classList.add('cooldown');

            currentMoney += clickPower;
            updateDisplay();
            set(ref(db, 'users/' + userId + '/money'), parseFloat(currentMoney.toFixed(2)));

            setTimeout(() => {
                isCooldown = false;
                clickBtn.classList.remove('cooldown');
            }, 1000);
        });

        function updateDisplay() {
            document.getElementById('money-display').innerText = '$' + currentMoney.toFixed(2);
            document.getElementById('cpc-display').innerText = '–ó–∞ –∫–ª–∏–∫: $' + clickPower.toFixed(2);
        }

        // --- –ú–ê–ì–ê–ó–ò–ù ---
        function renderShop() {
            const list = document.getElementById('shop-list');
            list.innerHTML = ""; 

            SHOP_ITEMS.forEach(item => {
                const isOwned = ownedUpgrades.includes(item.id);
                const el = document.createElement('div');
                el.className = "shop-item " + (isOwned ? "owned" : "");
                
                el.innerHTML = `
                    <div class="item-info">
                        <h4>${item.name}</h4>
                        <p>–ö–ª–∏–∫: $${item.power.toFixed(2)}</p>
                    </div>
                    <button class="buy-btn ${isOwned ? 'owned' : ''}" data-id="${item.id}">
                        ${isOwned ? '–ö—É–ø–ª–µ–Ω–æ' : '$' + item.price}
                    </button>
                `;
                
                const btn = el.querySelector('.buy-btn');
                if (!isOwned) {
                    btn.addEventListener('click', () => buyItem(item));
                }
                
                list.appendChild(el);
            });
        }

        function buyItem(item) {
            if (currentMoney >= item.price) {
                currentMoney -= item.price;
                let newUpgrades = [...ownedUpgrades, item.id];
                const updates = {};
                updates['/users/' + userId + '/money'] = parseFloat(currentMoney.toFixed(2));
                updates['/users/' + userId + '/upgrades'] = newUpgrades;
                update(ref(db), updates);
                alert(`–í—ã –∫—É–ø–∏–ª–∏ ${item.name}!`);
            } else {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
            }
        }

        // --- –®–ê–†–ò–ö–ò –ò –†–ï–ö–õ–ê–ú–ê ---
        function startBalloonSpawner() {
            // –°–ø–∞–≤–Ω —à–∞—Ä–∏–∫–æ–≤ (—Ä–∞–∑ –≤ 1 - 3 –º–∏–Ω—É—Ç—ã)
            const randomTime = Math.random() * (180000 - 60000) + 60000;
            const spawnDate = new Date(Date.now() + randomTime);
            
            // –ö–†–ê–°–ò–í–´–ô –õ–û–ì –í –ö–û–ù–°–û–õ–¨
            console.log(
                `%cüéÅ –°–ª–µ–¥—É—é—â–∏–π –ø–æ–¥–∞—Ä–æ–∫ –ø—Ä–∏–ª–µ—Ç–∏—Ç –≤: ${spawnDate.toLocaleTimeString()} (—á–µ—Ä–µ–∑ ${(randomTime/1000).toFixed(0)} —Å–µ–∫)`, 
                "color: #4caf50; font-size: 14px; font-weight: bold; background: #222; padding: 4px; border-radius: 4px;"
            );
            
            setTimeout(() => {
                spawnBalloon();
                startBalloonSpawner(); 
            }, randomTime);
        }

        function spawnBalloon() {
            const balloon = document.createElement('div');
            balloon.className = "bonus-balloon";
            const randomLeft = Math.random() * 70 + 10;
            balloon.style.left = randomLeft + "%";
            
            let topPos = -100;
            const speed = 2 + Math.random() * 2; 
            
            document.body.appendChild(balloon);
            
            const animInterval = setInterval(() => {
                topPos += speed;
                balloon.style.top = topPos + "px";
                if (topPos > window.innerHeight) {
                    clearInterval(animInterval);
                    balloon.remove();
                }
            }, 20);

            balloon.addEventListener('click', () => {
                clearInterval(animInterval);
                balloon.remove();
                generateOffer();
            });
        }

        function generateOffer() {
            const rand = Math.random() * 100;
            let rewardType = "", rewardValue = 0, itemId = "";

            if (rand < 40) { rewardType = "money"; rewardValue = 0.30; }
            else if (rand < 70) { rewardType = "money"; rewardValue = 0.50; }
            else if (rand < 85) { rewardType = "money"; rewardValue = 1.00; }
            else if (rand < 92) { rewardType = "item"; itemId = "salt"; }
            else if (rand < 96) { rewardType = "money"; rewardValue = 1.50; }
            else if (rand < 98) { rewardType = "item"; itemId = "wool"; }
            else { rewardType = "item"; itemId = "coal"; }

            if (rewardType === "money") {
                currentReward = { type: "money", value: rewardValue, text: `$${rewardValue.toFixed(2)}` };
            } else {
                const itemObj = SHOP_ITEMS.find(i => i.id === itemId);
                currentReward = { type: "item", id: itemId, text: itemObj.name };
                if (ownedUpgrades.includes(itemId)) {
                    currentReward = { type: "money", value: itemObj.price, text: `$${itemObj.price} (–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è)` };
                }
            }

            // –õ–û–ì–ò–ö–ê –ö–û–õ–ò–ß–ï–°–¢–í–ê –†–ï–ö–õ–ê–ú
            if (rewardType === "money" && rewardValue <= 1.00) {
                adsRequired = 1;
            } else {
                adsRequired = 2;
            }
            
            adsWatchedCount = 0;
            updateAdModalUI();
            document.getElementById('ad-modal').classList.add('active');
        }

        function updateAdModalUI() {
            document.getElementById('reward-text').innerText = currentReward.text;
            document.getElementById('ads-counter').innerText = `${adsWatchedCount}/${adsRequired}`;
            
            const btn = document.getElementById('watch-ad-btn');
            if (adsWatchedCount > 0 && adsWatchedCount < adsRequired) {
                btn.innerText = "–°–º–æ—Ç—Ä–µ—Ç—å —Å–ª–µ–¥—É—é—â—É—é";
            } else {
                btn.innerText = "–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É";
            }
        }

        document.getElementById('close-modal-btn').addEventListener('click', () => {
            document.getElementById('ad-modal').classList.remove('active');
        });

        document.getElementById('watch-ad-btn').addEventListener('click', () => {
            window.open(AD_LINK, '_blank');
            
            const btn = document.getElementById('watch-ad-btn');
            const originalText = btn.innerText;
            btn.innerText = "–ü—Ä–æ–≤–µ—Ä–∫–∞...";
            btn.disabled = true;

            setTimeout(() => {
                adsWatchedCount++;
                btn.disabled = false;
                
                if (adsWatchedCount >= adsRequired) {
                    giveReward();
                    document.getElementById('ad-modal').classList.remove('active');
                } else {
                    updateAdModalUI();
                }
            }, 3000); 
        });

        function giveReward() {
            if (!userId || !currentReward) return;
            const updates = {};
            if (currentReward.type === "money") {
                currentMoney += currentReward.value;
                updates['/users/' + userId + '/money'] = parseFloat(currentMoney.toFixed(2));
            } else if (currentReward.type === "item") {
                let newUpgrades = [...ownedUpgrades, currentReward.id];
                updates['/users/' + userId + '/upgrades'] = newUpgrades;
            }
            update(ref(db), updates);
            alert("–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!");
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => { window.location.href = "index.html"; });
        });
    </script>
</body>
</html>
