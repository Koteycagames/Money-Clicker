<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Money Clicker $$$</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://pl28381542.effectivegatecpm.com/a7/c6/45/a7c6454f1cdb67023344f46b3d0d4773.js"></script>
</head>
<body>

    <div id="ad-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>üéÅ –ë–æ–Ω—É—Å –Ω–∞–π–¥–µ–Ω!</h3>
            <p>–ù–∞–≥—Ä–∞–¥–∞: <span id="reward-text" class="reward-highlight">???</span></p>
            <p style="font-size: 0.8rem; color: #aaa;">–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∫–ª–∞–º—É, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É.</p>
            <button id="watch-ad-btn" style="background-color: #4caf50;">–°–º–æ—Ç—Ä–µ—Ç—å (+–ù–∞–≥—Ä–∞–¥–∞)</button>
            <button id="close-modal-btn" class="secondary-btn" style="background-color: #f44336;">–û—Ç–∫–∞–∑–∞—Ç—å—Å—è</button>
        </div>
    </div>

    <div class="container">
        <div id="user-info" style="font-size: 0.8rem; color: #888;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        
        <div id="money-display">$0.00</div>
        <div id="cpc-display" style="font-size: 0.8rem; color: #aaa; margin-bottom: 10px;">–ó–∞ –∫–ª–∏–∫: $0.01</div>
        
        <button id="click-btn">–ö–õ–ò–ö</button>
        
        <div class="tabs">
            <h3>üç™ –ú–∞–≥–∞–∑–∏–Ω –ü–µ—á–µ–Ω–µ–∫</h3>
            <div id="shop-list" class="shop-container">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞...</p>
            </div>
        </div>

        <div class="tabs">
            <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
            <p>–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...</p>
        </div>
        
        <div class="ad-container">
            <script async="async" data-cfasync="false" src="https://pl28384763.effectivegatecpm.com/4f46afbe5794b0570feb06a1295424d5/invoke.js"></script>
            <div id="container-4f46afbe5794b0570feb06a1295424d5"></div>
        </div>

        <button id="logoutBtn" class="logout-btn">–í—ã–π—Ç–∏</button>
    </div>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { ref, onValue, set, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        // –°—é–¥–∞ –º–æ–∂–µ—à—å –≤—Å—Ç–∞–≤–∏—Ç—å Direct Link –æ—Ç Adsterra, –µ—Å–ª–∏ –µ—Å—Ç—å. 
        // –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–ª –∑–∞–≥–ª—É—à–∫—É #.
        const AD_LINK = "https://www.google.com"; 

        // –°–ü–ò–°–û–ö –¢–û–í–ê–†–û–í (ID, –ò–º—è, –¶–µ–Ω–∞, –°–∏–ª–∞ –∫–ª–∏–∫–∞)
        const SHOP_ITEMS = [
            { id: "wool", name: "–®–µ—Ä—Å—Ç—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1, power: 0.10 },
            { id: "salt", name: "–°–æ–ª–µ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 3, power: 0.30 },
            { id: "coal", name: "–£–≥–æ–ª—å–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 5, power: 0.50 },
            { id: "foil", name: "–ü–µ—á–µ–Ω—å–µ –∏–∑ —Ñ–æ–ª—å–≥–∏", price: 30, power: 1.00 },
            { id: "alum", name: "–ê–ª—é–º–∏–Ω–∏–µ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 150, power: 1.50 },
            { id: "leaf", name: "–õ–∏—Å—Ç–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 400, power: 2.00 },
            { id: "copper", name: "–ú–µ–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 800, power: 3.00 },
            { id: "lead", name: "–°–≤–∏–Ω—Ü–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1000, power: 4.50 },
            { id: "tungsten", name: "–í–æ–ª—å—Ñ—Ä–∞–º–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1300, power: 6.00 },
            { id: "silver", name: "–°–µ—Ä–µ–±—Ä—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1750, power: 8.00 },
            { id: "gold", name: "–ó–æ–ª–æ—Ç–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 2000, power: 10.00 },
            { id: "emerald", name: "–ò–∑—É–º—Ä—É–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 2400, power: 13.00 },
            { id: "diamond", name: "–ê–ª–º–∞–∑–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 3500, power: 20.00 },
            { id: "rainbow", name: "–†–∞–¥—É–∂–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 5000, power: 30.00 }
        ];

        let currentMoney = 0.00;
        let clickPower = 0.01; // –ù–∞—á–∞–ª—å–Ω–∞—è —Å–∏–ª–∞
        let userId = null;
        let isCooldown = false;
        let ownedUpgrades = []; // –°–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö ID

        // --- FIREBASE LOGIC ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('user-info').innerText = "ID: " + user.email;
                
                const userRef = ref(db, 'users/' + userId);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        if (data.banned && data.banned !== false) {
                            window.location.href = "ban.html";
                            return;
                        }
                        
                        currentMoney = parseFloat(data.money) || 0;
                        ownedUpgrades = data.upgrades || ["start"];
                        
                        // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∏–ª—É –∫–ª–∏–∫–∞ (–±–µ—Ä–µ–º —Å–∞–º—É—é –º–æ—â–Ω—É—é –ø–µ—á–µ–Ω—å–∫—É –∏–∑ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö)
                        recalcClickPower();
                        
                        updateDisplay();
                        renderShop();
                    }
                });
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ø–∞–≤–Ω —à–∞—Ä–∏–∫–æ–≤
                startBalloonSpawner();
            } else {
                window.location.href = "index.html";
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Å–∏–ª—ã –∫–ª–∏–∫–∞
        function recalcClickPower() {
            let maxPower = 0.01; // –ë–∞–∑–∞
            SHOP_ITEMS.forEach(item => {
                if (ownedUpgrades.includes(item.id)) {
                    if (item.power > maxPower) maxPower = item.power;
                }
            });
            clickPower = maxPower;
        }

        // --- –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ---
        const clickBtn = document.getElementById('click-btn');

        clickBtn.addEventListener('click', () => {
            if (!userId || isCooldown) return;
            isCooldown = true;
            clickBtn.classList.add('cooldown');

            currentMoney += clickPower;
            updateDisplay();
            set(ref(db, 'users/' + userId + '/money'), parseFloat(currentMoney.toFixed(2)));

            setTimeout(() => {
                isCooldown = false;
                clickBtn.classList.remove('cooldown');
            }, 1000);
        });

        function updateDisplay() {
            document.getElementById('money-display').innerText = '$' + currentMoney.toFixed(2);
            document.getElementById('cpc-display').innerText = '–ó–∞ –∫–ª–∏–∫: $' + clickPower.toFixed(2);
        }

        // --- –ú–ê–ì–ê–ó–ò–ù ---
        function renderShop() {
            const list = document.getElementById('shop-list');
            list.innerHTML = ""; // –û—á–∏—Å—Ç–∏—Ç—å

            SHOP_ITEMS.forEach(item => {
                const isOwned = ownedUpgrades.includes(item.id);
                const el = document.createElement('div');
                el.className = "shop-item " + (isOwned ? "owned" : "");
                
                el.innerHTML = `
                    <div class="item-info">
                        <h4>${item.name}</h4>
                        <p>–ö–ª–∏–∫: $${item.power.toFixed(2)}</p>
                    </div>
                    <button class="buy-btn ${isOwned ? 'owned' : ''}" data-id="${item.id}">
                        ${isOwned ? '–ö—É–ø–ª–µ–Ω–æ' : '$' + item.price}
                    </button>
                `;
                
                // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏
                const btn = el.querySelector('.buy-btn');
                if (!isOwned) {
                    btn.addEventListener('click', () => buyItem(item));
                }
                
                list.appendChild(el);
            });
        }

        function buyItem(item) {
            if (currentMoney >= item.price) {
                // –°–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
                currentMoney -= item.price;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                let newUpgrades = [...ownedUpgrades, item.id];
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î (–¥–µ–Ω—å–≥–∏ –∏ –∞–ø–≥—Ä–µ–π–¥—ã)
                const updates = {};
                updates['/users/' + userId + '/money'] = parseFloat(currentMoney.toFixed(2));
                updates['/users/' + userId + '/upgrades'] = newUpgrades;
                
                update(ref(db), updates);
                alert(`–í—ã –∫—É–ø–∏–ª–∏ ${item.name}!`);
            } else {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
            }
        }

        // --- –°–ò–°–¢–ï–ú–ê –®–ê–†–ò–ö–û–í (–†–ï–ö–õ–ê–ú–ê) ---
        let currentReward = null;

        function startBalloonSpawner() {
            // –°–ø–∞–≤–Ω –∫–∞–∂–¥—ã–µ 15-40 —Å–µ–∫—É–Ω–¥ (—Å–ª—É—á–∞–π–Ω–æ)
            const randomTime = Math.random() * (40000 - 15000) + 15000;
            setTimeout(() => {
                spawnBalloon();
                startBalloonSpawner(); // –†–µ–∫—É—Ä—Å–∏—è –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏
            }, randomTime);
        }

        function spawnBalloon() {
            const balloon = document.createElement('div');
            balloon.className = "bonus-balloon";
            
            // –†–∞–Ω–¥–æ–º–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è X (—á—Ç–æ–±—ã –Ω–µ —É–ª–µ—Ç–∞–ª –∑–∞ –∫—Ä–∞—è, –±–µ—Ä–µ–º 10% - 80%)
            const randomLeft = Math.random() * 70 + 10;
            balloon.style.left = randomLeft + "%";
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ JS (–ø—Ä–æ—â–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ)
            let topPos = -100;
            const speed = 2 + Math.random() * 2; // –°–ª—É—á–∞–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
            
            document.body.appendChild(balloon);
            
            const animInterval = setInterval(() => {
                topPos += speed;
                balloon.style.top = topPos + "px";
                
                // –ï—Å–ª–∏ —É–ª–µ—Ç–µ–ª –≤–Ω–∏–∑
                if (topPos > window.innerHeight) {
                    clearInterval(animInterval);
                    balloon.remove();
                }
            }, 20);

            // –ö–ª–∏–∫ –ø–æ —à–∞—Ä–∏–∫—É
            balloon.addEventListener('click', () => {
                clearInterval(animInterval);
                balloon.remove();
                generateOffer();
            });
        }

        function generateOffer() {
            const rand = Math.random() * 100;
            let rewardType = "";
            let rewardValue = 0;
            let isItem = false;
            let itemId = "";

            // –®–∞–Ω—Å—ã (Loot Table)
            if (rand < 40) { // 0-40%
                rewardType = "money"; rewardValue = 0.30;
            } else if (rand < 70) { // 40-70%
                rewardType = "money"; rewardValue = 0.50;
            } else if (rand < 85) { // 70-85%
                rewardType = "money"; rewardValue = 1.00;
            } else if (rand < 92) { // 85-92% (–°–æ–ª–µ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ)
                rewardType = "item"; itemId = "salt";
            } else if (rand < 96) { // 92-96%
                rewardType = "money"; rewardValue = 1.50;
            } else if (rand < 98) { // 96-98% (–®–µ—Ä—Å—Ç—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ)
                rewardType = "item"; itemId = "wool";
            } else { // 98-100% (–£–≥–æ–ª—å–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ)
                rewardType = "item"; itemId = "coal";
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –Ω–∞–≥—Ä–∞–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ–∫–ª–∞–º—ã
            if (rewardType === "money") {
                currentReward = { type: "money", value: rewardValue, text: `$${rewardValue.toFixed(2)}` };
            } else {
                // –ò—â–µ–º –∏–º—è –ø—Ä–µ–¥–º–µ—Ç–∞
                const itemObj = SHOP_ITEMS.find(i => i.id === itemId);
                currentReward = { type: "item", id: itemId, text: itemObj.name };
                
                // –ï—Å–ª–∏ –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –µ—Å—Ç—å, –¥–∞–µ–º –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é –¥–µ–Ω—å–≥–∞–º–∏
                if (ownedUpgrades.includes(itemId)) {
                    currentReward = { type: "money", value: itemObj.price, text: `$${itemObj.price} (–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è)` };
                }
            }

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('reward-text').innerText = currentReward.text;
            document.getElementById('ad-modal').classList.add('active');
        }

        // –ö–Ω–æ–ø–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('close-modal-btn').addEventListener('click', () => {
            document.getElementById('ad-modal').classList.remove('active');
        });

        document.getElementById('watch-ad-btn').addEventListener('click', () => {
            // 1. –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∫–ª–∞–º—É (–≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ)
            window.open(AD_LINK, '_blank');
            
            // 2. –ò–º–∏—Ç–∏—Ä—É–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ (–ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "—Å–º–æ—Ç—Ä–∏—Ç")
            const btn = document.getElementById('watch-ad-btn');
            const originalText = btn.innerText;
            btn.innerText = "–ü—Ä–æ–≤–µ—Ä–∫–∞...";
            btn.disabled = true;

            setTimeout(() => {
                // 3. –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
                giveReward();
                
                // –°–±—Ä–æ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                document.getElementById('ad-modal').classList.remove('active');
                btn.innerText = originalText;
                btn.disabled = false;
            }, 3000); // 3 —Å–µ–∫—É–Ω–¥—ã –∑–∞–¥–µ—Ä–∂–∫–∏
        });

        function giveReward() {
            if (!userId || !currentReward) return;

            const updates = {};
            let msg = "";

            if (currentReward.type === "money") {
                currentMoney += currentReward.value;
                updates['/users/' + userId + '/money'] = parseFloat(currentMoney.toFixed(2));
                msg = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${currentReward.text}!`;
            } else if (currentReward.type === "item") {
                let newUpgrades = [...ownedUpgrades, currentReward.id];
                updates['/users/' + userId + '/upgrades'] = newUpgrades;
                msg = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${currentReward.text}!`;
            }

            update(ref(db), updates);
            // alert(msg); // –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∞–ª–µ—Ä—Ç, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => { window.location.href = "index.html"; });
        });
    </script>
</body>
</html>
