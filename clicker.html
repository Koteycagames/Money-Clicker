<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Money Clicker $$$</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://pl28381542.effectivegatecpm.com/a7/c6/45/a7c6454f1cdb67023344f46b3d0d4773.js"></script>
</head>
<body>

    <div id="loading-overlay">
        <div class="loader-spinner"></div>
        <h2 style="color:white;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</h2>
    </div>

    <div id="ad-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>üéÅ –ë–æ–Ω—É—Å –Ω–∞–π–¥–µ–Ω!</h3>
            <p>–ù–∞–≥—Ä–∞–¥–∞: <span id="reward-text" class="reward-highlight">???</span></p>
            <p style="margin: 10px 0; font-weight: bold; color: #fff;">
                –ù—É–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º: <span id="ads-counter" style="color: #4caf50;">0/0</span>
            </p>
            <button id="watch-ad-btn" style="background-color: #4caf50;">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É</button>
            <button id="close-modal-btn" class="secondary-btn" style="background-color: #f44336;">–û—Ç–∫–∞–∑–∞—Ç—å—Å—è</button>
        </div>
    </div>

    <div id="shop-modal" class="shop-modal-overlay">
        <div class="shop-content">
            <div class="shop-header">
                <h2 style="margin:0; color:#ff9800;">üç™ –ú–∞–≥–∞–∑–∏–Ω</h2>
                <button id="close-shop-btn" class="close-shop-btn">√ó</button>
            </div>
            <div id="shop-list" class="shop-list-scroll">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
            </div>
        </div>
    </div>

    <div id="main-container" class="container">
        <div id="user-info" style="font-size: 0.8rem; color: #888;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        
        <div id="money-display">$0.00</div>
        <div id="cpc-display" style="font-size: 0.8rem; color: #aaa; margin-bottom: 10px;">–ó–∞ –∫–ª–∏–∫: $0.01</div>
        
        <button id="click-btn">–ö–õ–ò–ö</button>
        
        <button id="open-shop-btn" class="shop-open-btn">üõí –û—Ç–∫—Ä—ã—Ç—å –ú–∞–≥–∞–∑–∏–Ω</button>

        <button id="logoutBtn" class="logout-btn">–í—ã–π—Ç–∏</button>
    </div>

    <div class="bottom-banner-container">
        <script>
          atOptions = {
            'key' : 'ba5b233760526a810caa77cf17293467',
            'format' : 'iframe',
            'height' : 90,
            'width' : 728,
            'params' : {}
          };
        </script>
        <script src="https://www.highperformanceformat.com/ba5b233760526a810caa77cf17293467/invoke.js"></script>
    </div>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        const AD_LINK = "https://www.effectivegatecpm.com/n7h7t8tnc?key=63d760e9d5c26b2ae739b39ba4062a5f"; 

        const SHOP_ITEMS = [
            { id: "wool", name: "–®–µ—Ä—Å—Ç—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1, power: 0.10 },
            { id: "salt", name: "–°–æ–ª–µ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 3, power: 0.30 },
            { id: "coal", name: "–£–≥–æ–ª—å–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 5, power: 0.50 },
            { id: "foil", name: "–ü–µ—á–µ–Ω—å–µ –∏–∑ —Ñ–æ–ª—å–≥–∏", price: 30, power: 1.00 },
            { id: "alum", name: "–ê–ª—é–º–∏–Ω–∏–µ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 150, power: 1.50 },
            { id: "leaf", name: "–õ–∏—Å—Ç–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 400, power: 2.00 },
            { id: "copper", name: "–ú–µ–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 800, power: 3.00 },
            { id: "lead", name: "–°–≤–∏–Ω—Ü–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1000, power: 4.50 },
            { id: "tungsten", name: "–í–æ–ª—å—Ñ—Ä–∞–º–æ–≤–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1300, power: 6.00 },
            { id: "silver", name: "–°–µ—Ä–µ–±—Ä—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 1750, power: 8.00 },
            { id: "gold", name: "–ó–æ–ª–æ—Ç–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 2000, power: 10.00 },
            { id: "emerald", name: "–ò–∑—É–º—Ä—É–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 2400, power: 13.00 },
            { id: "diamond", name: "–ê–ª–º–∞–∑–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 3500, power: 20.00 },
            { id: "rainbow", name: "–†–∞–¥—É–∂–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", price: 5000, power: 30.00 }
        ];

        let currentMoney = 0.00;
        let clickPower = 0.01; 
        let userId = null;
        let isCooldown = false;
        
        // –ù–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø
        let ownedUpgrades = []; 
        let equippedItem = "none"; // ID –Ω–∞–¥–µ—Ç–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞

        let adsRequired = 0;
        let adsWatchedCount = 0;
        let currentReward = null;
        let balloonTimerInterval = null;

        let isDataLoaded = false;
        let isInitialLoadDone = false;

        // --- FIREBASE ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('user-info').innerText = "ID: " + user.email;
                
                const userRef = ref(db, 'users/' + userId);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        if (data.banned && data.banned !== false) {
                            window.location.href = "ban.html";
                            return;
                        }
                        
                        currentMoney = parseFloat(data.money) || 0;
                        ownedUpgrades = data.upgrades || ["start"];
                        equippedItem = data.equipped || "none"; // –ß–∏—Ç–∞–µ–º —á—Ç–æ –Ω–∞–¥–µ—Ç–æ
                        
                        recalcClickPower();
                        updateDisplay();
                        renderShop(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏

                        if (!isInitialLoadDone) {
                            isInitialLoadDone = true; 
                            setTimeout(() => {
                                isDataLoaded = true;
                                const loader = document.getElementById('loading-overlay');
                                if (loader) {
                                    loader.style.opacity = '0';
                                    setTimeout(() => loader.remove(), 500);
                                }
                            }, 1500);
                        }
                    }
                });
                
                startBalloonSpawner();
            } else {
                window.location.href = "index.html";
            }
        });

        // --- –õ–û–ì–ò–ö–ê –°–ò–õ–´ –ö–õ–ò–ö–ê ---
        function recalcClickPower() {
            // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–¥–µ—Ç–æ - —Å–∏–ª–∞ 0.01
            if (equippedItem === "none" || equippedItem === "start") {
                clickPower = 0.01;
                return;
            }

            // –ò—â–µ–º –Ω–∞–¥–µ—Ç—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤ –±–∞–∑–µ –º–∞–≥–∞–∑–∏–Ω–∞
            const item = SHOP_ITEMS.find(i => i.id === equippedItem);
            if (item) {
                clickPower = item.power;
            } else {
                clickPower = 0.01; // –ï—Å–ª–∏ –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
            }
        }

        const clickBtn = document.getElementById('click-btn');
        clickBtn.addEventListener('click', () => {
            if (!userId || isCooldown || !isDataLoaded) return;

            isCooldown = true;
            clickBtn.classList.add('cooldown');

            currentMoney += clickPower;
            updateDisplay();
            set(ref(db, 'users/' + userId + '/money'), parseFloat(currentMoney.toFixed(2)));

            setTimeout(() => {
                isCooldown = false;
                clickBtn.classList.remove('cooldown');
            }, 1000);
        });

        function updateDisplay() {
            document.getElementById('money-display').innerText = '$' + currentMoney.toFixed(2);
            document.getElementById('cpc-display').innerText = '–ó–∞ –∫–ª–∏–∫: $' + clickPower.toFixed(2);
        }

        // --- –ù–û–í–´–ô –ú–ê–ì–ê–ó–ò–ù ---
        const shopModal = document.getElementById('shop-modal');
        const mainContainer = document.getElementById('main-container');

        // –û—Ç–∫—Ä—ã—Ç–∏–µ
        document.getElementById('open-shop-btn').addEventListener('click', () => {
            shopModal.classList.add('open');
            mainContainer.classList.add('blur-content'); // –†–∞–∑–º—ã–≤–∞–µ–º —Ñ–æ–Ω
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ
        document.getElementById('close-shop-btn').addEventListener('click', () => {
            shopModal.classList.remove('open');
            mainContainer.classList.remove('blur-content'); // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–º—ã—Ç–∏–µ
        });

        function renderShop() {
            const list = document.getElementById('shop-list');
            list.innerHTML = ""; 

            SHOP_ITEMS.forEach(item => {
                const isOwned = ownedUpgrades.includes(item.id);
                const isEquipped = (equippedItem === item.id);
                
                const el = document.createElement('div');
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å, –µ—Å–ª–∏ –Ω–∞–¥–µ—Ç–æ, –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
                el.className = "shop-item " + (isEquipped ? "equipped" : "");
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML
                let buttonHtml = '';
                
                if (isEquipped) {
                    buttonHtml = `<button class="shop-action-btn btn-equipped">–ù–∞–¥–µ—Ç–æ</button>`;
                } else if (isOwned) {
                    buttonHtml = `<button class="shop-action-btn btn-equip" data-action="equip" data-id="${item.id}">–ù–∞–¥–µ—Ç—å</button>`;
                } else {
                    buttonHtml = `<button class="shop-action-btn btn-buy" data-action="buy" data-id="${item.id}">–ö—É–ø–∏—Ç—å ($${item.price})</button>`;
                }

                el.innerHTML = `
                    <div class="item-info">
                        <h4>${item.name}</h4>
                        <p>–ö–ª–∏–∫: $${item.power.toFixed(2)}</p>
                    </div>
                    ${buttonHtml}
                `;
                
                // –í–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
                const btn = el.querySelector('button');
                if (btn.dataset.action === "buy") {
                    btn.addEventListener('click', () => buyItem(item));
                } else if (btn.dataset.action === "equip") {
                    btn.addEventListener('click', () => equipItem(item.id));
                }
                
                list.appendChild(el);
            });
            
            // –ö–Ω–æ–ø–∫–∞ "–°–Ω—è—Ç—å –≤—Å—ë" (–¥–ª—è —Ç–µ—Å—Ç–∞ –∏–ª–∏ –µ—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–ª–∏–∫)
            const unequipDiv = document.createElement('div');
            unequipDiv.style.textAlign = "center";
            unequipDiv.style.marginTop = "10px";
            unequipDiv.innerHTML = `<button class="shop-action-btn secondary-btn" style="width:100%">–°–Ω—è—Ç—å —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É</button>`;
            unequipDiv.querySelector('button').addEventListener('click', () => equipItem("none"));
            list.appendChild(unequipDiv);
        }

        function buyItem(item) {
            if (!isDataLoaded) return;
            if (currentMoney >= item.price) {
                currentMoney -= item.price;
                let newUpgrades = [...ownedUpgrades, item.id];
                const updates = {};
                updates['/users/' + userId + '/money'] = parseFloat(currentMoney.toFixed(2));
                updates['/users/' + userId + '/upgrades'] = newUpgrades;
                update(ref(db), updates);
                // –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∞–¥–µ—Ç—å, –Ω–æ –ø–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º —Ä—É—á–Ω–æ–µ
            } else {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
            }
        }

        // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
        function equipItem(itemId) {
            if (!isDataLoaded) return;
            // –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ equipped –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            update(ref(db, 'users/' + userId), {
                equipped: itemId
            });
        }

        // --- –õ–û–ì–ò–ö–ê –¢–ê–ô–ú–ï–†–ê –ò –®–ê–†–ò–ö–û–í ---
        function startBalloonSpawner() {
            if (balloonTimerInterval) clearInterval(balloonTimerInterval);
            const waitTime = Math.floor(Math.random() * (180000 - 60000) + 60000);
            const targetTime = Date.now() + waitTime;
            console.log("%cüéÅ –¢–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω!", "color: yellow; font-weight: bold;");

            balloonTimerInterval = setInterval(() => {
                const now = Date.now();
                const diff = targetTime - now;
                const secondsLeft = Math.ceil(diff / 1000);

                if (diff <= 0) {
                    clearInterval(balloonTimerInterval);
                    console.log("%cüéÅ –í–†–ï–ú–Ø! –í—ã–ø—É—Å–∫–∞–µ–º —à–∞—Ä–∏–∫!", "color: lime; font-weight: bold; font-size: 14px;");
                    spawnBalloon();
                    startBalloonSpawner();
                } else {
                    console.log(`‚è≥ –î–æ –ø–æ–¥–∞—Ä–∫–∞: ${secondsLeft} —Å–µ–∫`);
                }
            }, 1000);
        }

        function spawnBalloon() {
            const balloon = document.createElement('div');
            balloon.className = "bonus-balloon";
            const randomLeft = Math.random() * 70 + 10;
            balloon.style.left = randomLeft + "%";
            let topPos = -100;
            const speed = 2 + Math.random() * 2; 
            document.body.appendChild(balloon);
            const animInterval = setInterval(() => {
                topPos += speed;
                balloon.style.top = topPos + "px";
                if (topPos > window.innerHeight) {
                    clearInterval(animInterval);
                    balloon.remove();
                }
            }, 20);
            balloon.addEventListener('click', () => {
                clearInterval(animInterval);
                balloon.remove();
                generateOffer();
            });
        }

        function generateOffer() {
            const rand = Math.random() * 100;
            let rewardType = "", rewardValue = 0, itemId = "";

            if (rand < 40) { rewardType = "money"; rewardValue = 0.30; }
            else if (rand < 70) { rewardType = "money"; rewardValue = 0.50; }
            else if (rand < 85) { rewardType = "money"; rewardValue = 1.00; }
            else if (rand < 92) { rewardType = "item"; itemId = "salt"; }
            else if (rand < 96) { rewardType = "money"; rewardValue = 1.50; }
            else if (rand < 98) { rewardType = "item"; itemId = "wool"; }
            else { rewardType = "item"; itemId = "coal"; }

            if (rewardType === "money") {
                currentReward = { type: "money", value: rewardValue, text: `$${rewardValue.toFixed(2)}` };
            } else {
                const itemObj = SHOP_ITEMS.find(i => i.id === itemId);
                currentReward = { type: "item", id: itemId, text: itemObj.name };
                if (ownedUpgrades.includes(itemId)) {
                    currentReward = { type: "money", value: itemObj.price, text: `$${itemObj.price} (–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è)` };
                }
            }

            if (rewardType === "money" && rewardValue <= 1.00) adsRequired = 1;
            else adsRequired = 2;
            
            adsWatchedCount = 0;
            updateAdModalUI();
            document.getElementById('ad-modal').classList.add('active');
        }

        function updateAdModalUI() {
            document.getElementById('reward-text').innerText = currentReward.text;
            document.getElementById('ads-counter').innerText = `${adsWatchedCount}/${adsRequired}`;
            const btn = document.getElementById('watch-ad-btn');
            if (adsWatchedCount > 0 && adsWatchedCount < adsRequired) btn.innerText = "–°–º–æ—Ç—Ä–µ—Ç—å —Å–ª–µ–¥—É—é—â—É—é";
            else btn.innerText = "–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É";
        }

        document.getElementById('close-modal-btn').addEventListener('click', () => {
            document.getElementById('ad-modal').classList.remove('active');
        });

        document.getElementById('watch-ad-btn').addEventListener('click', () => {
            window.open(AD_LINK, '_blank');
            const btn = document.getElementById('watch-ad-btn');
            btn.innerText = "–ü—Ä–æ–≤–µ—Ä–∫–∞...";
            btn.disabled = true;
            setTimeout(() => {
                adsWatchedCount++;
                btn.disabled = false;
                if (adsWatchedCount >= adsRequired) {
                    giveReward();
                    document.getElementById('ad-modal').classList.remove('active');
                } else {
                    updateAdModalUI();
                }
            }, 3000); 
        });

        function giveReward() {
            if (!userId || !currentReward) return;
            const updates = {};
            if (currentReward.type === "money") {
                currentMoney += currentReward.value;
                updates['/users/' + userId + '/money'] = parseFloat(currentMoney.toFixed(2));
            } else if (currentReward.type === "item") {
                let newUpgrades = [...ownedUpgrades, currentReward.id];
                updates['/users/' + userId + '/upgrades'] = newUpgrades;
            }
            update(ref(db), updates);
            alert("–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!");
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => { window.location.href = "index.html"; });
        });
    </script>
</body>
</html>
